---
title: "Projet"
output: html_document
date: "2023-12-11"
---
##Examen des Données:

Avant de se plonger dans des analyses spécifiques, il est essentiel d'examiner les données pour comprendre leur structure, leurs variables et leurs statistiques de base. Nous chargerons les données, examinerons les premières lignes et passerons en revue les types de données et les statistiques sommaires.
```{r setup, include=FALSE}

library(readr)
#library(tidyverse)
library(dplyr)
library(ggplot2)
library(stats)


# Lecture des ensembles de données
day_data <- read_csv("bike+sharing+dataset/day.csv")
hour_data <- read_csv("bike+sharing+dataset/hour.csv")

```




```{r cars}
# Affichage des premières lignes de l'ensemble de données journalier
head(day_data)

# Résumé de l'ensemble de données journalier
summary(day_data)

# Structure de l'ensemble de données journalier
str(day_data)

```


```{r pressure, echo=FALSE}
# Affichage des premières lignes de l'ensemble de données horaires
head(hour_data)

# Résumé de l'ensemble de données horaires
summary(hour_data)

str(hour_data)
```
```{r}
sum(is.na(hour_data))
sum(is.na(day_data))
```
```{r}
sum(duplicated(hour_data))
sum(duplicated(day_data))
```


Nous allons maintenant examiner nos données pour répondre aux questions spécifiques posées.

##Changements de Température Selon les Saisons
#Comment les températures changent-elles selon les saisons ? Quelles sont les températures moyennes et médianes ?

Pour répondre à cette question, nous analyserons la température (temp) par saison et calculerons les moyennes et médianes.
```{r}
library(dplyr)

# Calcul de la température moyenne et médiane par saison
temperature_stats <- day_data %>%
  group_by(season) %>%
  summarise(mean_temp = mean(temp, na.rm = TRUE),
            median_temp = median(temp, na.rm = TRUE))

# Affichage des résultats
print(temperature_stats)

```
Cette partie du code permet d'obtenir une vue d'ensemble des températures par saison, ce qui est crucial pour comprendre comment les conditions météorologiques influencent l'utilisation des vélos.


##Y a-t-il une corrélation entre la température (temp/atemp) et le nombre total de locations de vélos ?

Nous examinerons la corrélation entre la température, la température ressentie et le nombre total de locations.

```{r}

# Charger la bibliothèque corrplot si ce n'est pas déjà fait
# Si vous ne l'avez pas déjà installée, exécutez install.packages("corrplot")
library(corrplot)

# Calculer la température moyenne entre temp et atemp
day_data$mean_temp_atemp <- rowMeans(day_data[, c("temp", "atemp")])

# Calculer la matrice de corrélation
correlation_matrix <- cor(day_data[, c("temp", "atemp", "mean_temp_atemp", "cnt")], use = "complete.obs")

# Visualiser la matrice de corrélation
corrplot(correlation_matrix, method = "circle")


```

#Quelles sont les températures moyennes, l'humidité, la vitesse du vent et les locations totales par mois ?

Nous calculerons ces moyennes pour chaque mois pour identifier des tendances saisonnières.


Les valeurs de température, d'humidité et de vitesse du vent sont normalisées. La température moyenne est la plus élevée en juillet (0.755) et la plus basse en décembre (0.324). L'humidité est relativement stable tout au long de l'année avec une légère augmentation pendant les mois d'été. La vitesse du vent moyenne est généralement la plus faible en juillet (0.166) et la plus élevée en avril (0.234). Le nombre de locations de vélos est le plus élevé en juin (5772.37) et le plus bas en janvier (2176.34).
```{r}
# Calcul des moyennes mensuelles
monthly_averages <- day_data %>%
  group_by(mnth) %>%
  summarise(
    mean_temp = mean(temp, na.rm = TRUE),
    mean_humidity = mean(hum, na.rm = TRUE),
    mean_windspeed = mean(windspeed, na.rm = TRUE),
    mean_rentals = mean(cnt, na.rm = TRUE)
  )

# Affichage des moyennes mensuelles
print(monthly_averages)

```


#La température est-elle associée aux locations de vélos (enregistrés vs occasionnels) ?

Nous étudierons comment la température affecte différemment les utilisateurs enregistrés et occasionnels.
```{r}
# Association de la température avec les locations de vélos
rentals_by_temp <- day_data %>%
  group_by(temp) %>%
  summarise(mean_casual = mean(casual),
            mean_registered = mean(registered))

# Visualisation
ggplot(rentals_by_temp, aes(x = temp)) +
  geom_line(aes(y = mean_casual, color = "Occasionnel")) +
  geom_line(aes(y = mean_registered, color = "Enregistré")) +
  labs(title = "Locations de Vélos par Température",
       x = "Température Normalisée",
       y = "Locations Moyennes")
```


```{r}
# Calcul de la corrélation entre température et locations pour les utilisateurs enregistrés et occasionnels
correlation_temp_users <- day_data %>%
  select(temp, casual, registered) %>%
  cor(use = "complete.obs")

# Affichage de la matrice de corrélation
print(correlation_temp_users)

```


Calculer la corrélation entre la température et les locations pour les utilisateurs enregistrés et occasionnels.

Résumer comment les locations moyennes varient avec la température en regroupant les températures par intervalles puis en calculant le nombre moyen de locations pour chaque groupe.
????????????????????je ne sais pas




```{r}
# Conversion de 'dteday' en format de date
day_data$dteday <- as.Date(day_data$dteday, format="%Y-%m-%d")

# Tracé de 'cnt' vs 'dteday'
ggplot(day_data, aes(x=dteday, y=cnt)) + 
  geom_line() + 
  labs(title="Nombre de locations de vélos par jour", 
       x="Date", 
       y="Nombre total de locations de vélos") +
  theme(axis.text.x = element_text(angle=90, hjust=1))

```
Il y a une saison annuelle, on voit une tendance ( mois plus chauds implique hausse des locations et une baisse pendant les mois plus froids). La variance est plus au moins constante.



```{r}


# Conversion de 'dteday' en format de date
day_data$dteday <- as.Date(day_data$dteday, format="%Y-%m-%d")

# Identifier les valeurs aberrantes, par exemple en utilisant la méthode des écarts interquartiles
IQR_values <- IQR(day_data$cnt)
quantiles <- quantile(day_data$cnt, probs=c(.25, .75))
cap <- quantiles[2] + 1.5 * IQR_values
floor <- quantiles[1] - 1.5 * IQR_values

# Filtrer les valeurs aberrantes
day_data <- day_data %>%
  filter(cnt >= floor & cnt <= cap)

# Gérer les valeurs manquantes, par exemple, en les remplaçant par la moyenne
day_data$cnt[is.na(day_data$cnt)] <- mean(day_data$cnt, na.rm = TRUE)

# Lisser la série temporelle en utilisant une moyenne mobile avec la fonction 'filter' du package 'stats'
day_data$cnttimeseries <- ts(day_data$cnt)

# Comparer la série lissée avec l'originale
ggplot(day_data, aes(x=dteday)) + 
  geom_line(aes(y=cnttimeseries), color="blue") + 
  geom_line(aes(y=cnt), color="red") +
  labs(title="Comparaison du Nombre de Locations Original et Lissé par Jour", 
       x="Date", 
       y="Nombre de Locations") +
  theme(axis.text.x = element_text(angle=90, hjust=1))

```

```{r}
# Convertir la colonne cnt en time series
day_data$cnttimeseries <- ts(day_data$cnt, frequency = 1)

# Tracer la série temporelle originale
plot(day_data$cnt, col = 'red', type = 'l', xlab = 'Time', ylab = 'Number of Bike Rentals',
     main = 'Comparison of Original and Smoothed Bike Rentals per Day')

# Ajouter la série lissée
lines(day_data$cnttimeseries, col = 'blue')

# Ajouter une légende
legend('topright', legend = c('Original', 'Smoothed'), col = c('red', 'blue'), lty = 1, bty = 'n')
```


```{r}
log_cntts <- log(day_data$cnttimeseries)
plot(log_cntts)
```




```{r}

#diff on season
cnttimeseries_s <- diff(log_cntts, lag=12)
plot(cnttimeseries_s)

```


```{r}
pacf(cnttimeseries_s,lag.max=100, main="PACF")
```


```{r}
acf(cnttimeseries_s,lag.max= 100, main="ACF")

```


```{r}
#MA(3) ou AR(1)
#ARIMA(1,0,0)(4,1,0)h=12 ***
#ARIMA(0,0,3)(4,1,0)h=12 ****
#ARIMA(1,0,0)(0,1,2)h=12 *
#ARIMA(0,0,3)(0,1,2)h=12 **

#on regarde les valeurs de ACF et PACF à chaque début de saison
#on remarque un pique sur le ACF et le PACF donc P=4 ou Q=2
```



```{r}
model_m1 <- arima(log_cntts, order = c(0, 0, 3), seasonal = list(order = c(4, 1, 0), period = 12))

residuals_m1 <- residuals(model_m1)
plot(residuals_m1)
#mean=0 var=cte 
par(mfrow = c(2, 1))
acf(residuals_m1, main = "ACF of Residuals")
pacf(residuals_m1, main = "PACF of Residuals")
#no significant peak on the ACF and PACF

Box.test(residuals_m1, type = "Ljung-Box")
#p-value= 0.8709
aic_value_m1 <- AIC(model_m1)
cat("AIC du modèle m1:", aic_value_m1, "\n")
#AIC=740.9598
```



```{r}
model_m2 <- arima(log_cntts, order = c(0, 0, 3), seasonal = list(order = c(0, 1, 1), period = 12))

residuals_m2 <- residuals(model_m2)
plot(residuals_m2)
#mean=0 var=cte 
par(mfrow = c(2, 1))
acf(residuals_m2, main = "ACF of Residuals")
pacf(residuals_m2, main = "PACF of Residuals")
#no significant peak on the ACF and PACF

Box.test(residuals_m2, type = "Ljung-Box")
#p-value= 0.8193
aic_value_m2 <- AIC(model_m2)
cat("AIC du modèle m2:", aic_value_m2, "\n")
#AIC=728.3433 
```
```{r}
model_m3 <- arima(log_cntts, order = c(1, 0, 0), seasonal = list(order = c(4, 1, 0), period = 12))

residuals_m3 <- residuals(model_m3)
plot(residuals_m3)
#mean=0 var=cte 
par(mfrow = c(2, 1))
acf(residuals_m3, main = "ACF of Residuals")
pacf(residuals_m3, main = "PACF of Residuals")
#no significant peak on the ACF and PACF

Box.test(residuals_m3, type = "Ljung-Box")
#p-value= 0.5306
aic_value_m3 <- AIC(model_m3)
cat("AIC du modèle m3:", aic_value_m3, "\n")
#AIC=728.3557 
```
```{r}
model_m4 <- arima(log_cntts, order = c(1, 0, 0), seasonal = list(order = c(0, 1, 2), period = 12))

residuals_m4 <- residuals(model_m4)
plot(residuals_m4)
#mean=0 var=cte 
par(mfrow = c(2, 1))
acf(residuals_m4, main = "ACF of Residuals")
pacf(residuals_m4, main = "PACF of Residuals")
#no significant peak on the ACF and PACF

Box.test(residuals_m4, type = "Ljung-Box")
#p-value= 0.0414
aic_value_m4 <- AIC(model_m4)
cat("AIC du modèle m4:", aic_value_m4, "\n")
#AIC=706.1448 
```
